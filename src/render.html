<html>
<head>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.3.1/handlebars.min.js"></script>
<script>
console.log('Handlebars:', Handlebars)
function loadJSON(path, callback) {   
    var xobj = new XMLHttpRequest();
    xobj.overrideMimeType("application/json");
    xobj.open('GET', path, true);
    xobj.onreadystatechange = function () {
      if (xobj.readyState == 4 && xobj.status == "200") {
        callback(JSON.parse(xobj.responseText));
      }
    };
    xobj.send(null);  
}

function render(obj) {
    console.log('in render')
    times_t = document.getElementById("times_t").innerHTML
    console.log('found template')
    console.log('Handlebars:', Handlebars)
    times_render = Handlebars.compile(times_t)
    console.log('compiled template')
    pages = []
    console.log('# of pages:', obj.pages.length)
    for (page of obj.pages) {
        console.log('compiling page')
        pages.push(times_render(page))
    }
    page_div = document.getElementById("page")
    page_div.innerHTML = pages[0]
}

window.onload = function() {
    alert('hello')
    console.log
    var urlParams = new URLSearchParams(window.location.search);
    loadJSON((urlParams.get('json') || 'rh-raw') + '.json', render);
}
</script>
</head>
<body>
<H1>Test Page</H1>
<template id="times_t">
    {{#each sections}}
        <h2>{{title}}</h2>
        {{#each ITEMS}}
            <br>TITLE: {{title}}
            <br>COMMENT: {{comment}}
            <br>TIME: {{time}}
            <hr/>
        {{/each}}
    {{/each}}
</template>
<template id="time_t">
</template>
<div id="page">
LOADING...
</div>
</body>
</html>
